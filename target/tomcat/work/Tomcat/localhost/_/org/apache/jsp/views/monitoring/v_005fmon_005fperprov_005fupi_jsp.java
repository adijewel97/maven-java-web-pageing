/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-05-23 03:43:38 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.views.monitoring;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class v_005fmon_005fperprov_005fupi_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("<div class=\"pt-4 px-4\">\r\n");
      out.write("    <h2 class=\"page-title\">Monitoring Pelanggan BPBL Per Provinsi / UPI</h2>\r\n");
      out.write("\r\n");
      out.write("    <div class=\"container mt-4\">\r\n");
      out.write("        <div class=\"form-monitoring\">\r\n");
      out.write("            <h5 class=\"section-title\">Monitoring Per UPI / Provinsi</h5>\r\n");
      out.write("\r\n");
      out.write("            <form id=\"form-monitoring\">\r\n");
      out.write("                <div class=\"row g-3 mb-3\">\r\n");
      out.write("                    <div class=\"col-md-4\">\r\n");
      out.write("                        <label for=\"jenis\" class=\"form-label\">Jenis</label>\r\n");
      out.write("                        <select class=\"form-select\" id=\"jenis\" name=\"jenis\">\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"col-md-4\">\r\n");
      out.write("                        <label for=\"selectdata\" class=\"form-label\">Kriteria Data</label>\r\n");
      out.write("                        <select id=\"selectdata\" class=\"form-select\">\r\n");
      out.write("                            <option value=\"TOTAL_SUMBER\">TOTAL SUMBER</option>\r\n");
      out.write("                            <option value=\"NIK_BLM_VALID\">NIK BELUM VALID</option>\r\n");
      out.write("                            <option value=\"NIK_VALID\">NIK VALID</option>\r\n");
      out.write("                            <option value=\"NIK_VALID_KOREKSI\">NIK VALID KOREKSI</option>\r\n");
      out.write("                            <option value=\"BLM_VERIFIKASI_DJK\">BELUM VERIFIKASI DJK</option>\r\n");
      out.write("                            <option value=\"VERIFIKASI_DJK\">VERIFIKASI DJK</option>\r\n");
      out.write("                            <option value=\"VERIFIKASI_DJK_MANUAL\">VERIFIKASI DJK MANUAL</option>\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"col-md-4\">\r\n");
      out.write("                        <label for=\"selectTahun\" class=\"form-label\">Tahun</label>\r\n");
      out.write("                        <select class=\"form-select\" id=\"selectTahun\" name=\"selectTahun\">\r\n");
      out.write("                            <option value=\"2025\">2025</option>\r\n");
      out.write("                            <option value=\"2024\">2024</option>\r\n");
      out.write("                            <option value=\"2023\">2023</option>\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>                \r\n");
      out.write("\r\n");
      out.write("                <div class=\"row\">\r\n");
      out.write("                    <div class=\"col-md-12 text-start\">\r\n");
      out.write("                        <button id=\"btnTampil\" type=\"button\" class=\"btn btn-primary\">\r\n");
      out.write("                            <i class=\"bi bi-search\"></i> Tampilkan\r\n");
      out.write("                        </button>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </form>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <div class=\"mt-4\">\r\n");
      out.write("            <div class=\"mb-2\">\r\n");
      out.write("                <button id=\"downloadExcelBtnPage\" class=\"btn btn-success btn-export\">Download Excel Per Halaman</button>\r\n");
      out.write("                <button id=\"downloadExcelBtnAll\" class=\"btn btn-primary btn-export\">Download Excel Semua Halaman</button>\r\n");
      out.write("            </div>\r\n");
      out.write("\r\n");
      out.write("            <!-- Menggunakan class dari CSS external -->\r\n");
      out.write("            <div class=\"datatable-container\">\r\n");
      out.write("                <table id=\"bpblTable\" class=\"datatable-main\">\r\n");
      out.write("                    <thead>\r\n");
      out.write("                        <tr>\r\n");
      out.write("                            <th class=\"col-no\">NO</th> \r\n");
      out.write("                            <!-- <th>TOTAL_COUNT</th>  -->\r\n");
      out.write("                            <th>DATA</th> \r\n");
      out.write("                            <th>ID_KOLEKTIF</th> \r\n");
      out.write("                            <th>IDURUT_BPBL</th> \r\n");
      out.write("                            <th>TANGGAL_USULAN</th> \r\n");
      out.write("                            <th>KODE_PENGUSUL</th> \r\n");
      out.write("                            <th class=\"col-nama-pelanggan\">NAMA_PELANGGAN</th> \r\n");
      out.write("                            <th>NIK</th> \r\n");
      out.write("                            <th class=\"col-alamat\">ALAMAT</th> \r\n");
      out.write("                            <th>KD_PROV</th> \r\n");
      out.write("                            <th>KD_PROV_USULAN</th> \r\n");
      out.write("                            <th>PROVINSI</th> \r\n");
      out.write("                            <th>PROVINSI_USULAN</th> \r\n");
      out.write("                            <th>KD_KAB</th> \r\n");
      out.write("                            <th>KD_KAB_USULAN</th> \r\n");
      out.write("                            <th>KABUPATENKOTA</th> \r\n");
      out.write("                            <th>KABUPATENKOTA_USULAN</th> \r\n");
      out.write("                            <th>KD_KEC</th> \r\n");
      out.write("                            <th>KD_KEC_USULAN</th> \r\n");
      out.write("                            <th>KECAMATAN</th> \r\n");
      out.write("                            <th>KECAMATAN_USULAN</th> \r\n");
      out.write("                            <th>KD_KEL</th> \r\n");
      out.write("                            <th>KD_KEL_USULAN</th> \r\n");
      out.write("                            <th>DESAKELURAHAN</th> \r\n");
      out.write("                            <th>DESAKELURAHAN_USULAN</th> \r\n");
      out.write("                            <th>UNITUPI</th> \r\n");
      out.write("                            <th>NAMA_UNITUPI</th> \r\n");
      out.write("                            <th>UNITAP</th> \r\n");
      out.write("                            <th>NAMA_UNITAP</th> \r\n");
      out.write("                            <th>UNITUP</th> \r\n");
      out.write("                            <th>NAMA_UNITUP</th> \r\n");
      out.write("                            <th class=\"col-status\">STATUS</th> \r\n");
      out.write("                            <th>USER_ID</th> \r\n");
      out.write("                            <th>TGL_UPLOAD</th> \r\n");
      out.write("                            <th class=\"col-file\">NAMA_FILE_UPLOAD</th> \r\n");
      out.write("                            <th>PATH_FILE</th> \r\n");
      out.write("                            <th class=\"col-file\">DOKUMEN_UPLOAD</th> \r\n");
      out.write("                            <th>PATH_DOKUMEN</th> \r\n");
      out.write("                            <th>SURAT_VALDES</th> \r\n");
      out.write("                            <th>PRIORITAS</th> \r\n");
      out.write("                            <th>VERIFIKASI_DJK</th> \r\n");
      out.write("                            <th>SUMBER_DATA</th> \r\n");
      out.write("                            <th class=\"col-keterangan\">KETERANGAN</th> \r\n");
      out.write("                            <th class=\"col-tahun\">TAHUN</th> \r\n");
      out.write("                            <th>TGL_KOREKSI</th> \r\n");
      out.write("                            <th>USERID_KOREKSI</th> \r\n");
      out.write("                            <th class=\"col-file\">NAMA_FILE_KOREKSI</th> \r\n");
      out.write("                            <th>PATH_FILE_KOREKSI</th> \r\n");
      out.write("                            <!-- <th>ROW_NUMBER</th>  -->\r\n");
      out.write("                            <th>USERID_VERIFIKASI</th> \r\n");
      out.write("                            <th>STATUS_VERIFIKASI</th> \r\n");
      out.write("                            <th>TGL_VERIFIKASI</th> \r\n");
      out.write("                        </tr>\r\n");
      out.write("                    </thead>\r\n");
      out.write("                    <tbody>\r\n");
      out.write("                    </tbody>\r\n");
      out.write("                </table>\r\n");
      out.write("            </div>\r\n");
      out.write("        \r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<!-- SheetJS untuk export Excel -->\r\n");
      out.write("<script src=\"https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js\"></script>\r\n");
      out.write("\r\n");
      out.write("<script>\r\n");
      out.write("    $(document).ready(function () {\r\n");
      out.write("        var orderColumnMap = {\r\n");
      out.write("            'PROVINSI': 12,  // Kolom PROVINSI index ke-12 (0 based)\r\n");
      out.write("            'UPI': 25,       // Kolom UNITUPI index ke-25\r\n");
      out.write("            'PENGUSUL': 6    // KODE_PENGUSUL index ke-6\r\n");
      out.write("        };\r\n");
      out.write("\r\n");
      out.write("        // Panggil controller saat halaman dimuat\r\n");
      out.write("        $.ajax({\r\n");
      out.write("            url: '");
      out.print( request.getContextPath() );
      out.write("/bpbl?act=handleGetJenisLaporan',\r\n");
      out.write("            method: 'POST',\r\n");
      out.write("            dataType: 'json',\r\n");
      out.write("            success: function (response) {\r\n");
      out.write("                var jenisSelect = $('#jenis');\r\n");
      out.write("                jenisSelect.empty();\r\n");
      out.write("\r\n");
      out.write("                var dataList = response.data || [];\r\n");
      out.write("                console.log(\"combo 1\");\r\n");
      out.write("                console.log(dataList);\r\n");
      out.write("\r\n");
      out.write("                $.each(dataList, function (i, item) {\r\n");
      out.write("                    jenisSelect.append($('<option>', {\r\n");
      out.write("                        value: item.kode,\r\n");
      out.write("                        text: item.laporan                    \r\n");
      out.write("                    }));\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            error: function (xhr, status, error) {\r\n");
      out.write("                console.error('Gagal mengambil data combo jenis laporan:', error);\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $.ajax({\r\n");
      out.write("            url: '");
      out.print( request.getContextPath() );
      out.write("/bpbl?act=handleGetsumberdata',\r\n");
      out.write("            method: 'POST',\r\n");
      out.write("            dataType: 'json',\r\n");
      out.write("            success: function (response) {\r\n");
      out.write("                var jenisSelect = $('#selectsumberdata');\r\n");
      out.write("                jenisSelect.empty();\r\n");
      out.write("\r\n");
      out.write("                var dataList = response.data || [];\r\n");
      out.write("                console.log(\"combo 2\");\r\n");
      out.write("                console.log(dataList);\r\n");
      out.write("\r\n");
      out.write("                $.each(dataList, function (i, item) {\r\n");
      out.write("                    jenisSelect.append($('<option>', {\r\n");
      out.write("                        value: item.kode,\r\n");
      out.write("                        text: item.sumber_data                    \r\n");
      out.write("                    }));\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            error: function (xhr, status, error) {\r\n");
      out.write("                console.error('Gagal mengambil data combo jenis laporan:', error);\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        var table = $('#bpblTable').DataTable({\r\n");
      out.write("            processing: true,\r\n");
      out.write("            serverSide: true,\r\n");
      out.write("            scrollX: true,\r\n");
      out.write("            paging: true,\r\n");
      out.write("            ajax: {\r\n");
      out.write("                url: '");
      out.print( request.getContextPath() );
      out.write("/bpbl',\r\n");
      out.write("                type: 'POST',\r\n");
      out.write("                data: function (d) {\r\n");
      out.write("                    d.vtahun = $('#selectTahun').val();\r\n");
      out.write("                    d.voption = $('#jenis').val();\r\n");
      out.write("                    d.vdata = $('#selectdata').val();\r\n");
      out.write("                },\r\n");
      out.write("                dataSrc: function (json) {\r\n");
      out.write("                    console.log('Response JSON:', json);\r\n");
      out.write("                    return json.data;\r\n");
      out.write("                },\r\n");
      out.write("                error: function (xhr, error, thrown) {\r\n");
      out.write("                    console.error('Status:', status);\r\n");
      out.write("                    console.error('Error thrown:', error);\r\n");
      out.write("                    console.error('Response:', xhr.responseText);\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            columns: [\r\n");
      out.write("                {\r\n");
      out.write("                    data: null,\r\n");
      out.write("                    render: function (data, type, row, meta) {\r\n");
      out.write("                        return meta.row + 1 + meta.settings._iDisplayStart;\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                ...[\r\n");
      out.write("                    // 'TOTAL_COUNT',\r\n");
      out.write("                    'DATA', 'ID_KOLEKTIF', 'IDURUT_BPBL', 'TANGGAL_USULAN', 'KODE_PENGUSUL',\r\n");
      out.write("                    'NAMA_PELANGGAN', 'NIK', 'ALAMAT', 'KD_PROV', 'KD_PROV_USULAN', 'PROVINSI',\r\n");
      out.write("                    'PROVINSI_USULAN', 'KD_KAB', 'KD_KAB_USULAN', 'KABUPATENKOTA', 'KABUPATENKOTA_USULAN',\r\n");
      out.write("                    'KD_KEC', 'KD_KEC_USULAN', 'KECAMATAN', 'KECAMATAN_USULAN', 'KD_KEL', 'KD_KEL_USULAN',\r\n");
      out.write("                    'DESAKELURAHAN', 'DESAKELURAHAN_USULAN', 'UNITUPI', 'NAMA_UNITUPI', 'UNITAP', 'NAMA_UNITAP',\r\n");
      out.write("                    'UNITUP', 'NAMA_UNITUP', 'STATUS', 'USER_ID', 'TGL_UPLOAD', 'NAMA_FILE_UPLOAD',\r\n");
      out.write("                    'PATH_FILE', 'DOKUMEN_UPLOAD', 'PATH_DOKUMEN', 'SURAT_VALDES', 'PRIORITAS',\r\n");
      out.write("                    'VERIFIKASI_DJK', 'SUMBER_DATA', 'KETERANGAN', 'TAHUN', 'TGL_KOREKSI',\r\n");
      out.write("                    'USERID_KOREKSI', 'NAMA_FILE_KOREKSI', 'PATH_FILE_KOREKSI',\r\n");
      out.write("                    // , 'ROW_NUMBER'\r\n");
      out.write("                    \"USERID_VERIFIKASI\", \"STATUS_VERIFIKASI\", \"TGL_VERIFIKASI\"\r\n");
      out.write("                ].map(field => ({\r\n");
      out.write("                    data: field,\r\n");
      out.write("                    defaultContent: '-',\r\n");
      out.write("                    render: function (data, type, row) {\r\n");
      out.write("                        return typeof data === 'string' ? data.toUpperCase() : data;\r\n");
      out.write("                    }\r\n");
      out.write("                }))\r\n");
      out.write("            ],\r\n");
      out.write("            lengthMenu: [[10, 100, 5000], [10, 100, 5000]],\r\n");
      out.write("            pageLength: 10,\r\n");
      out.write("            dom: 'lfrtip',\r\n");
      out.write("            buttons: [\r\n");
      out.write("                {\r\n");
      out.write("                    extend: 'excel',\r\n");
      out.write("                    title: 'Daftar BPBL',\r\n");
      out.write("                    className: 'd-none',\r\n");
      out.write("                    exportOptions: {\r\n");
      out.write("                        columns: ':visible'\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("            ]\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $('#btnTampil').click(function () {\r\n");
      out.write("            table.ajax.reload(null, true);\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $('#jenis, #selectdata, #selectTahun, #selectsumberdata').on('change', function () {\r\n");
      out.write("            table.ajax.reload();\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $('#downloadExcelBtnPage').on('click', function () {\r\n");
      out.write("            table.button('.buttons-excel').trigger();\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        $('#downloadExcelBtnAll').on('click', async function () {\r\n");
      out.write("            const btn = $(this);\r\n");
      out.write("\r\n");
      out.write("            const vtahun  = $('#selectTahun').val();\r\n");
      out.write("            const voption = $('#jenis').val();\r\n");
      out.write("            const vdata   = $('#selectdata').val();\r\n");
      out.write("\r\n");
      out.write("            if (!vtahun || !voption || !vdata) {\r\n");
      out.write("                alert('Silakan pilih Tahun, Jenis, dan Kriteria Data terlebih dahulu!');\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            const info = table.page.info();\r\n");
      out.write("            const start = info.start;\r\n");
      out.write("            const length = info.length;\r\n");
      out.write("\r\n");
      out.write("            btn.prop('disabled', true).text('Memuat...');\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                const baseUrl = window.location.origin;\r\n");
      out.write("                const url = baseUrl + \"");
      out.print( request.getContextPath() );
      out.write("/bpbl\";\r\n");
      out.write("\r\n");
      out.write("                const params = new URLSearchParams();\r\n");
      out.write("                params.append('all', 'true');\r\n");
      out.write("                params.append('vtahun', vtahun);\r\n");
      out.write("                params.append('voption', voption);\r\n");
      out.write("                params.append('vdata', vdata);\r\n");
      out.write("                params.append('start', start);\r\n");
      out.write("                params.append('length', length);\r\n");
      out.write("\r\n");
      out.write("                const response = await fetch(url, {\r\n");
      out.write("                    method: 'POST',\r\n");
      out.write("                    headers: {\r\n");
      out.write("                        'Content-Type': 'application/x-www-form-urlencoded',\r\n");
      out.write("                    },\r\n");
      out.write("                    body: params.toString()\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                if (!response.ok) {\r\n");
      out.write("                    throw new Error('Gagal mengambil data dari server');\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                const json = await response.json();\r\n");
      out.write("                const allData = json.data || [];\r\n");
      out.write("\r\n");
      out.write("                const headers = {\r\n");
      out.write("                    'NO': '',\r\n");
      out.write("                    'DATA': '',\r\n");
      out.write("                    'ID_KOLEKTIF': '',\r\n");
      out.write("                    'IDURUT_BPBL': '',\r\n");
      out.write("                    'TANGGAL_USULAN': '',\r\n");
      out.write("                    'KODE_PENGUSUL': '',\r\n");
      out.write("                    'NAMA_PELANGGAN': '',\r\n");
      out.write("                    'NIK': '',\r\n");
      out.write("                    'ALAMAT': '',\r\n");
      out.write("                    'KD_PROV': '',\r\n");
      out.write("                    'KD_PROV_USULAN': '',\r\n");
      out.write("                    'PROVINSI': '',\r\n");
      out.write("                    'PROVINSI_USULAN': '',\r\n");
      out.write("                    'KD_KAB': '',\r\n");
      out.write("                    'KD_KAB_USULAN': '',\r\n");
      out.write("                    'KABUPATENKOTA': '',\r\n");
      out.write("                    'KABUPATENKOTA_USULAN': '',\r\n");
      out.write("                    'KD_KEC': '',\r\n");
      out.write("                    'KD_KEC_USULAN': '',\r\n");
      out.write("                    'KECAMATAN': '',\r\n");
      out.write("                    'KECAMATAN_USULAN': '',\r\n");
      out.write("                    'KD_KEL': '',\r\n");
      out.write("                    'KD_KEL_USULAN': '',\r\n");
      out.write("                    'DESAKELURAHAN': '',\r\n");
      out.write("                    'DESAKELURAHAN_USULAN': '',\r\n");
      out.write("                    'UNITUPI': '',\r\n");
      out.write("                    'NAMA_UNITUPI': '',\r\n");
      out.write("                    'UNITAP': '',\r\n");
      out.write("                    'NAMA_UNITAP': '',\r\n");
      out.write("                    'UNITUP': '',\r\n");
      out.write("                    'NAMA_UNITUP': '',\r\n");
      out.write("                    'STATUS': '',\r\n");
      out.write("                    'USER_ID': '',\r\n");
      out.write("                    'TGL_UPLOAD': '',\r\n");
      out.write("                    'NAMA_FILE_UPLOAD': '',\r\n");
      out.write("                    'PATH_FILE': '',\r\n");
      out.write("                    'DOKUMEN_UPLOAD': '',\r\n");
      out.write("                    'PATH_DOKUMEN': '',\r\n");
      out.write("                    'SURAT_VALDES': '',\r\n");
      out.write("                    'PRIORITAS': '',\r\n");
      out.write("                    'VERIFIKASI_DJK': '',\r\n");
      out.write("                    'SUMBER_DATA': '',\r\n");
      out.write("                    'KETERANGAN': '',\r\n");
      out.write("                    'TAHUN': '',\r\n");
      out.write("                    'TGL_KOREKSI': '',\r\n");
      out.write("                    'USERID_KOREKSI': '',\r\n");
      out.write("                    'NAMA_FILE_KOREKSI': '',\r\n");
      out.write("                    'PATH_FILE_KOREKSI': '',\r\n");
      out.write("                    'USERID_VERIFIKASI': '',\r\n");
      out.write("                    'STATUS_VERIFIKASI': '',\r\n");
      out.write("                    'TGL_VERIFIKASI': '',\r\n");
      out.write("                };\r\n");
      out.write("\r\n");
      out.write("                const formattedData = allData.length > 0\r\n");
      out.write("                    ? allData.map((item) => {\r\n");
      out.write("                        const row = {};\r\n");
      out.write("                        Object.keys(headers).forEach((key) => {\r\n");
      out.write("                            const value = item[key];\r\n");
      out.write("                            row[key] = (typeof value === 'string') ? value.toUpperCase() : value;\r\n");
      out.write("                        });\r\n");
      out.write("                        row['NO'] = item.ROW_NUMBER; // Tetap gunakan nomor urut asli\r\n");
      out.write("                        return row;\r\n");
      out.write("                    })\r\n");
      out.write("                    : [];\r\n");
      out.write("\r\n");
      out.write("                const ws = XLSX.utils.json_to_sheet(formattedData, { header: Object.keys(headers) });\r\n");
      out.write("                const wb = XLSX.utils.book_new();\r\n");
      out.write("                XLSX.utils.book_append_sheet(wb, ws, \"BPBL Semua Data\");\r\n");
      out.write("\r\n");
      out.write("                const filename = \"BPBL_\" + voption + \"_\" + vdata + \"_\" + vtahun + \".xlsx\";\r\n");
      out.write("                XLSX.writeFile(wb, filename);\r\n");
      out.write("\r\n");
      out.write("            } catch (error) {\r\n");
      out.write("                alert('Terjadi kesalahan saat mengambil data: ' + error.message);\r\n");
      out.write("                console.error('Detail error:', error);\r\n");
      out.write("            } finally {\r\n");
      out.write("                btn.prop('disabled', false).text('Download Excel Semua Halaman');\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    });\r\n");
      out.write("</script>");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}

/*
 * Generated by the Jasper component of Apache Tomcat
 * Version: Apache Tomcat/7.0.47
 * Generated at: 2025-05-29 13:11:25 UTC
 * Note: The last modified time of this file was set to
 *       the last modified time of the source file after
 *       generation to assist with modification tracking.
 */
package org.apache.jsp.views.monitoring;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;

public final class v1a_005fmon_005fperprov_005fupi_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final javax.servlet.jsp.JspFactory _jspxFactory =
          javax.servlet.jsp.JspFactory.getDefaultFactory();

  private static java.util.Map<java.lang.String,java.lang.Long> _jspx_dependants;

  private javax.el.ExpressionFactory _el_expressionfactory;
  private org.apache.tomcat.InstanceManager _jsp_instancemanager;

  public java.util.Map<java.lang.String,java.lang.Long> getDependants() {
    return _jspx_dependants;
  }

  public void _jspInit() {
    _el_expressionfactory = _jspxFactory.getJspApplicationContext(getServletConfig().getServletContext()).getExpressionFactory();
    _jsp_instancemanager = org.apache.jasper.runtime.InstanceManagerFactory.getInstanceManager(getServletConfig());
  }

  public void _jspDestroy() {
  }

  public void _jspService(final javax.servlet.http.HttpServletRequest request, final javax.servlet.http.HttpServletResponse response)
        throws java.io.IOException, javax.servlet.ServletException {

    final javax.servlet.jsp.PageContext pageContext;
    javax.servlet.http.HttpSession session = null;
    final javax.servlet.ServletContext application;
    final javax.servlet.ServletConfig config;
    javax.servlet.jsp.JspWriter out = null;
    final java.lang.Object page = this;
    javax.servlet.jsp.JspWriter _jspx_out = null;
    javax.servlet.jsp.PageContext _jspx_page_context = null;


    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;

      out.write("\r\n");
      out.write("\r\n");
      out.write("<!-- Modal Large -->\r\n");
      out.write("<div class=\"modal fade\" id=\"dataModal\" tabindex=\"-1\" aria-labelledby=\"dataModalLabel\" aria-hidden=\"true\">\r\n");
      out.write("  <div class=\"modal-dialog modal-dialog-scrollable modal-xl\">\r\n");
      out.write("    <div class=\"modal-content\">\r\n");
      out.write("      <div class=\"modal-header\">\r\n");
      out.write("        <h5 class=\"modal-title\" id=\"dataModalLabel\">Detail Data</h5>\r\n");
      out.write("        <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"modal\" aria-label=\"Tutup\"></button>\r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-body\" id=\"modalBody\">\r\n");
      out.write("        <div class=\"mb-2\">\r\n");
      out.write("            <button id=\"downloadExcelBtnAll\" class=\"btn btn-primary btn-export\">Download Excel Semua Halaman</button>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <!-- Isi modal akan diisi via JS -->\r\n");
      out.write("          <div class=\"datatable-container\">\r\n");
      out.write("                <table id=\"table_mondaf_provupi\" class=\"datatable-main\">\r\n");
      out.write("                    <thead>\r\n");
      out.write("                        <tr>\r\n");
      out.write("                            <th>No</th>\r\n");
      out.write("                            <!-- <th>TOTAL_COUNT</th>  -->\r\n");
      out.write("                            <th>DATA</th> \r\n");
      out.write("                            <th>ID_KOLEKTIF</th> \r\n");
      out.write("                            <th>IDURUT_BPBL</th> \r\n");
      out.write("                            <th>TANGGAL_USULAN</th> \r\n");
      out.write("                            <th>KODE_PENGUSUL</th> \r\n");
      out.write("                            <th>NAMA_PELANGGAN</th> \r\n");
      out.write("                            <th>NIK</th> \r\n");
      out.write("                            <th>ALAMAT</th> \r\n");
      out.write("                            <th>KD_PROV</th> \r\n");
      out.write("                            <th>KD_PROV_USULAN</th> \r\n");
      out.write("                            <th>PROVINSI</th> \r\n");
      out.write("                            <th>PROVINSI_USULAN</th> \r\n");
      out.write("                            <th>KD_KAB</th> \r\n");
      out.write("                            <th>KD_KAB_USULAN</th> \r\n");
      out.write("                            <th>KABUPATENKOTA</th> \r\n");
      out.write("                            <th>KABUPATENKOTA_USULAN</th> \r\n");
      out.write("                            <th>KD_KEC</th> \r\n");
      out.write("                            <th>KD_KEC_USULAN</th> \r\n");
      out.write("                            <th>KECAMATAN</th> \r\n");
      out.write("                            <th>KECAMATAN_USULAN</th> \r\n");
      out.write("                            <th>KD_KEL</th> \r\n");
      out.write("                            <th>KD_KEL_USULAN</th> \r\n");
      out.write("                            <th>DESAKELURAHAN</th> \r\n");
      out.write("                            <th>DESAKELURAHAN_USULAN</th> \r\n");
      out.write("                            <th>UNITUPI</th> \r\n");
      out.write("                            <th>NAMA_UNITUPI</th> \r\n");
      out.write("                            <th>UNITAP</th> \r\n");
      out.write("                            <th>NAMA_UNITAP</th> \r\n");
      out.write("                            <th>UNITUP</th> \r\n");
      out.write("                            <th>NAMA_UNITUP</th> \r\n");
      out.write("                            <th>STATUS_UPLOAD</th> \r\n");
      out.write("                            <th>STATUS_DATA</th> \r\n");
      out.write("                            <th>USER_ID</th> \r\n");
      out.write("                            <th>TGL_UPLOAD</th> \r\n");
      out.write("                            <th>NAMA_FILE_UPLOAD</th> \r\n");
      out.write("                            <th>PATH_FILE</th> \r\n");
      out.write("                            <th>DOKUMEN_UPLOAD</th> \r\n");
      out.write("                            <th>PATH_DOKUMEN</th> \r\n");
      out.write("                            <th>SURAT_VALDES</th> \r\n");
      out.write("                            <th>PRIORITAS</th> \r\n");
      out.write("                            <th>VERIFIKASI_DJK</th> \r\n");
      out.write("                            <th>SUMBER_DATA</th> \r\n");
      out.write("                            <th>KETERANGAN</th> \r\n");
      out.write("                            <th>TAHUN</th> \r\n");
      out.write("                            <th>TGL_KOREKSI</th> \r\n");
      out.write("                            <th>USERID_KOREKSI</th> \r\n");
      out.write("                            <th>NAMA_FILE_KOREKSI</th> \r\n");
      out.write("                            <th>PATH_FILE_KOREKSI</th> \r\n");
      out.write("                            <th>USERID_VERIFIKASI</th> \r\n");
      out.write("                            <th>STATUS_VERIFIKASI</th> \r\n");
      out.write("                            <th>TGL_VERIFIKASI</th> \r\n");
      out.write("                            <th>STATUS_CUTOFF</th> \r\n");
      out.write("                            <!-- <th>ROW_NUMBER</th>  -->\r\n");
      out.write("                        </tr>\r\n");
      out.write("                    </thead>\r\n");
      out.write("                </table>\r\n");
      out.write("          </div>          \r\n");
      out.write("      </div>\r\n");
      out.write("      <div class=\"modal-footer\">\r\n");
      out.write("        <button type=\"button\" class=\"btn btn-secondary\" data-bs-dismiss=\"modal\">Tutup</button>\r\n");
      out.write("      </div>\r\n");
      out.write("    </div>\r\n");
      out.write("  </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("\r\n");
      out.write("<div class=\"pt-4 px-4\">\r\n");
      out.write("    <h2 class=\"page-title\">Monitoring Pelanggan BPBL Per Provinsi / UPI</h2>\r\n");
      out.write("\r\n");
      out.write("    <div class=\"container mt-4\">\r\n");
      out.write("        <div class=\"form-monitoring\">\r\n");
      out.write("            <h5 class=\"section-title\">Monitoring Per UPI / Provinsi</h5>\r\n");
      out.write("\r\n");
      out.write("            <form id=\"form-monitoring\">\r\n");
      out.write("                <div class=\"row g-3 mb-3\">\r\n");
      out.write("                    <div class=\"col-md-3\">\r\n");
      out.write("                        <label for=\"jenis\" class=\"form-label\">Jenis</label>\r\n");
      out.write("                        <select class=\"form-select\" id=\"jenis\" name=\"jenis\">\r\n");
      out.write("                            <!-- Option akan diisi melalui JavaScript -->\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"col-md-3\">\r\n");
      out.write("                        <label for=\"selectTahun\" class=\"form-label\">Tahun</label>\r\n");
      out.write("                        <select class=\"form-select\" id=\"selectTahun\" name=\"selectTahun\">\r\n");
      out.write("                            <option value=\"2025\">2025</option>\r\n");
      out.write("                            <option value=\"2024\">2024</option>\r\n");
      out.write("                            <option value=\"2023\">2023</option>\r\n");
      out.write("                            <option value=\"2022\">2022</option>\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                    <div class=\"col-md-3\">\r\n");
      out.write("                        <label for=\"selectsumberdata\" class=\"form-label\">Sumber Data</label>\r\n");
      out.write("                        <select class=\"form-select\" id=\"selectsumberdata\" name=\"selectsumberdata\">\r\n");
      out.write("                            <!-- Option akan diisi melalui JavaScript -->\r\n");
      out.write("                        </select>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("\r\n");
      out.write("                <div class=\"row\">\r\n");
      out.write("                    <div class=\"col-md-12 text-start\">\r\n");
      out.write("                        <button id=\"btnTampil\" type=\"button\" class=\"btn btn-primary\">\r\n");
      out.write("                            <i class=\"bi bi-search\"></i> Tampilkan\r\n");
      out.write("                        </button>\r\n");
      out.write("                    </div>\r\n");
      out.write("                </div>\r\n");
      out.write("            </form>\r\n");
      out.write("        </div>\r\n");
      out.write("\r\n");
      out.write("        <div class=\"mt-4\">\r\n");
      out.write("            <div class=\"mb-2\">\r\n");
      out.write("                <button id=\"downloadExcelBtnPage\" class=\"btn btn-success btn-export\">Download Excel Per Halaman</button>\r\n");
      out.write("            </div>\r\n");
      out.write("\r\n");
      out.write("            <div class=\"datatable-container\">\r\n");
      out.write("                <table id=\"tablemon_provupi\" class=\"datatable-main table table-bordered table-striped\">\r\n");
      out.write("                    <thead>\r\n");
      out.write("                        <tr>\r\n");
      out.write("                            <th>URUT</th> \r\n");
      out.write("                            <th>KODE</th> \r\n");
      out.write("                            <th>NAMA</th> \r\n");
      out.write("                            <th>TAHUN</th> \r\n");
      out.write("                            <th>SUMBER_DATA</th> \r\n");
      out.write("                            <th>TARGET</th> \r\n");
      out.write("                            <th>TOTAL_SUMBER</th> \r\n");
      out.write("                            <th>NIK_BLM_VALID</th> \r\n");
      out.write("                            <th>NIK_VALID</th> \r\n");
      out.write("                            <th>NIK_VALID_KOREKSI</th> \r\n");
      out.write("                            <th>TOTAL_NIK_VALID</th> \r\n");
      out.write("                            <th>BLM_VERIFIKASI_DJK</th> \r\n");
      out.write("                            <th>VERIFIKASI_DJK_VALID</th> \r\n");
      out.write("                            <th>BLM_KIRIM_PRASURVEY</th> \r\n");
      out.write("                            <th>KIRIM_PRASURVEY</th> \r\n");
      out.write("                            <th>BLM_CUTOFF_SURVEY</th> \r\n");
      out.write("                            <th>CUTOFF_SURVEY</th> \r\n");
      out.write("                            <th>PERSEN_DATAVERIFIKASI</th> \r\n");
      out.write("                            <th>PERSEN_TARGET</th> \r\n");
      out.write("                        </tr>\r\n");
      out.write("                    </thead>\r\n");
      out.write("                    <tbody></tbody>\r\n");
      out.write("                </table>\r\n");
      out.write("            </div>\r\n");
      out.write("        </div>\r\n");
      out.write("    </div>\r\n");
      out.write("</div>\r\n");
      out.write("\r\n");
      out.write("<script src=\"https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js\"></script>\r\n");
      out.write("<script src=\"https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js\"></script>\r\n");
      out.write("\r\n");
      out.write("<script>\r\n");
      out.write("    $(document).ready(function () {\r\n");
      out.write("\r\n");
      out.write("        // Ambil data jenis laporan\r\n");
      out.write("        $.ajax({\r\n");
      out.write("            url: '");
      out.print( request.getContextPath() );
      out.write("/monperprovperupi?act=handleGetJenisLaporan',\r\n");
      out.write("            method: 'POST',\r\n");
      out.write("            dataType: 'json',\r\n");
      out.write("            success: function (response) {\r\n");
      out.write("                const jenisSelect = $('#jenis');\r\n");
      out.write("                jenisSelect.empty();\r\n");
      out.write("\r\n");
      out.write("                const dataList = response.data || [];\r\n");
      out.write("                console.log(\"Combo Jenis Laporan:\", dataList);\r\n");
      out.write("\r\n");
      out.write("                // const optionsHtml = dataList.map(item =>\r\n");
      out.write("                //     `<option value=\"");
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${item.kode}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write('"');
      out.write('>');
      out.write((java.lang.String) org.apache.jasper.runtime.PageContextImpl.proprietaryEvaluate("${item.laporan}", java.lang.String.class, (javax.servlet.jsp.PageContext)_jspx_page_context, null, false));
      out.write("</option>`\r\n");
      out.write("                // ).join('');\r\n");
      out.write("                // jenisSelect.html(optionsHtml);\r\n");
      out.write("                 $.each(dataList, function (i, item) {\r\n");
      out.write("                    jenisSelect.append($('<option>', {\r\n");
      out.write("                        value: item.kode,\r\n");
      out.write("                        text: item.laporan                    \r\n");
      out.write("                    }));\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            error: function (xhr, status, error) {\r\n");
      out.write("                console.error('Gagal mengambil data combo jenis laporan:', error);\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Ambil data sumber data\r\n");
      out.write("        $.ajax({\r\n");
      out.write("            url: '");
      out.print( request.getContextPath() );
      out.write("/monperprovperupi?act=handleGetsumberdata',\r\n");
      out.write("            method: 'POST',\r\n");
      out.write("            dataType: 'json',\r\n");
      out.write("            success: function (response) {\r\n");
      out.write("                const sumberDataSelect = $('#selectsumberdata');\r\n");
      out.write("                sumberDataSelect.empty();\r\n");
      out.write("\r\n");
      out.write("                const dataList = response.data || [];\r\n");
      out.write("                console.log(\"Combo Sumber Data:\", dataList);\r\n");
      out.write("\r\n");
      out.write("                 $.each(dataList, function (i, item) {\r\n");
      out.write("                    sumberDataSelect.append($('<option>', {\r\n");
      out.write("                        value: item.kode,\r\n");
      out.write("                        text: item.sumber_data                    \r\n");
      out.write("                    }));\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            error: function (xhr, status, error) {\r\n");
      out.write("                console.error('Gagal mengambil data combo sumber data:', error);\r\n");
      out.write("                alert('Gagal mengambil data combo sumber data:', error);\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Inisialisasi DataTable\r\n");
      out.write("        const table = $('#tablemon_provupi').DataTable({\r\n");
      out.write("            processing: true,\r\n");
      out.write("            serverSide: true,\r\n");
      out.write("            scrollX: true,\r\n");
      out.write("            paging: false, // MATIKAN PAGING\r\n");
      out.write("            stripeClasses: [], // Nonaktifkan efek baris selang-seling\r\n");
      out.write("            ajax: {\r\n");
      out.write("                url: '");
      out.print( request.getContextPath() );
      out.write("/monperprovperupi',\r\n");
      out.write("                type: 'POST',\r\n");
      out.write("                timeout: 10000, // 20 detik\r\n");
      out.write("                data: function (d) {\r\n");
      out.write("                    d.vkd_sumberdata = $('#selectsumberdata').val();\r\n");
      out.write("                    d.vtahun         = $('#selectTahun').val();\r\n");
      out.write("                },\r\n");
      out.write("                dataSrc: function (json) {\r\n");
      out.write("                    console.log('Response JSON:', json);\r\n");
      out.write("                    return json.data;\r\n");
      out.write("                },\r\n");
      out.write("                error: function (xhr, error, thrown) {\r\n");
      out.write("                    console.error('Status:', xhr.status);\r\n");
      out.write("                    console.error('Error thrown:', error);\r\n");
      out.write("                    console.error('Response:', xhr.responseText);\r\n");
      out.write("\r\n");
      out.write("                    if (error === 'timeout') {\r\n");
      out.write("                        alert('Permintaan data melebihi waktu tunggu 10 detik. Silakan periksa koneksi atau coba lagi nanti.');\r\n");
      out.write("                    } else {\r\n");
      out.write("                        alert('Terjadi kesalahan saat memuat data: ' + error);\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("            },\r\n");
      out.write("            columns: [\r\n");
      out.write("                {data: 'URUT', visible: false}, // ini untuk logika styling\r\n");
      out.write("                {data: 'KODE',  defaultContent: ''},\r\n");
      out.write("                {data: 'NAMA',  defaultContent: ''},\r\n");
      out.write("                {data: 'TAHUN',  defaultContent: ''},\r\n");
      out.write("                {data: 'SUMBER_DATA',  defaultContent: '-'},\r\n");
      out.write("                {data: 'TARGET',  defaultContent: '-'},\r\n");
      out.write("                {data: 'TOTAL_SUMBER',  defaultContent: '-'},\r\n");
      out.write("                {data: 'NIK_BLM_VALID',  defaultContent: '-'},\r\n");
      out.write("                {data: 'NIK_VALID',  defaultContent: '-'},\r\n");
      out.write("                {data: 'NIK_VALID_KOREKSI',  defaultContent: '-'},\r\n");
      out.write("                {data: 'TOTAL_NIK_VALID',  defaultContent: '-'},\r\n");
      out.write("                {data: 'BLM_VERIFIKASI_DJK',  defaultContent: '-'},\r\n");
      out.write("                {data: 'VERIFIKASI_DJK_VALID',  defaultContent: '-'},\r\n");
      out.write("                {data: 'BLM_KIRIM_PRASURVEY',  defaultContent: '-'},\r\n");
      out.write("                {data: 'KIRIM_PRASURVEY',  defaultContent: '-'},\r\n");
      out.write("                {data: 'BLM_CUTOFF_SURVEY',  defaultContent: '-'},\r\n");
      out.write("                {data: 'CUTOFF_SURVEY',  defaultContent: '-'},\r\n");
      out.write("                {data: 'PERSEN_DATAVERIFIKASI',  defaultContent: '-'},\r\n");
      out.write("                {data: 'PERSEN_TARGET',  defaultContent: '-'}\r\n");
      out.write("            ],\r\n");
      out.write("            createdRow: function (row, data, dataIndex) {\r\n");
      out.write("                if (data.URUT == 2) {\r\n");
      out.write("                    $('td', row).css({ 'font-weight': 'bold' });  \r\n");
      out.write("                } \r\n");
      out.write("\r\n");
      out.write("                $('td', row).each(function (colIndex) {\r\n");
      out.write("                    const columnName = table.column(colIndex+1).dataSrc();\r\n");
      out.write("                    const cellValue  = data[columnName];\r\n");
      out.write("                    const vidkd_sumberdata  = $('#selectsumberdata').val();\r\n");
      out.write("                    const vidjenis          = $('#jenis').val();\r\n");
      out.write("                        \r\n");
      out.write("                    // Tambahkan event klik seperti sebelumnya\r\n");
      out.write("                    const allowedColumns = ['KODE', 'NAMA', 'TAHUN', 'TARGET', 'SUMBER_DATA','PERSEN_DATAVERIFIKASI','PERSEN_TARGET'];\r\n");
      out.write("                    if (!allowedColumns.includes(columnName) && (!isNaN(cellValue) && Number(cellValue) > 0)) {\r\n");
      out.write("                        $(this).css({\r\n");
      out.write("                            'cursor': 'pointer',\r\n");
      out.write("                            'text-decoration': 'underline',\r\n");
      out.write("                            'color': 'blue'\r\n");
      out.write("                        }).on('click', function () {\r\n");
      out.write("                            $('#dataModalLabel').text('Detail: ' + columnName);\r\n");
      out.write("\r\n");
      out.write("                        if (data.URUT == 1) {\r\n");
      out.write("                            xvtahun      = data.TAHUN,\r\n");
      out.write("                            xvidoption   = data.KODE;\r\n");
      out.write("                            xvidkolektif = data.kolektif;\r\n");
      out.write("                        } \r\n");
      out.write("                        else  if (data.URUT == 2) {\r\n");
      out.write("                            xvtahun      = $('#selectTahun').val(),\r\n");
      out.write("                            xvidoption   = '';\r\n");
      out.write("                            xvidkolektif = '';\r\n");
      out.write("                        }\r\n");
      out.write("\r\n");
      out.write("                        detailFilterParams = {\r\n");
      out.write("                            vidurut: data.URUT,\r\n");
      out.write("                            vkd_sumberdata: data.SUMBER_DATA == 'DAPIL/PEMDA' ? '' : $('#selectsumberdata').val(),\r\n");
      out.write("                            vtahun: xvtahun,\r\n");
      out.write("                            vdata: columnName,\r\n");
      out.write("                            voption: $('#jenis').val(),\r\n");
      out.write("                            vidoption: xvidoption,\r\n");
      out.write("                            vidkolektif: xvidkolektif\r\n");
      out.write("                        };\r\n");
      out.write("                        console.log(detailFilterParams);\r\n");
      out.write("\r\n");
      out.write("                        $('#dataModal').modal('show');\r\n");
      out.write("                        });\r\n");
      out.write("                    }\r\n");
      out.write("                });\r\n");
      out.write("            },\r\n");
      out.write("            dom: 'lfrtip',\r\n");
      out.write("            buttons: [\r\n");
      out.write("                {\r\n");
      out.write("                    extend: 'excel',\r\n");
      out.write("                    title: function () {\r\n");
      out.write("                        const jenis = $('#jenis').val() || 'JENIS';\r\n");
      out.write("                        const tahun = $('#selectTahun').val() || 'TAHUN';\r\n");
      out.write("                        return 'REKAP_BPBL_' + jenis + '_' + tahun;\r\n");
      out.write("                        },\r\n");
      out.write("                    className: 'd-none',\r\n");
      out.write("                    exportOptions: {\r\n");
      out.write("                        // columns: ':visible'\r\n");
      out.write("                        columns: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18] // skip kolom ke-0 (URUT)\r\n");
      out.write("                    }\r\n");
      out.write("                }\r\n");
      out.write("            ]\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Tombol Tampil\r\n");
      out.write("        $('#btnTampil').click(function () {\r\n");
      out.write("            table.ajax.reload(null, true);\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Reload table saat filter berubah\r\n");
      out.write("        $('#jenis, #selectdata, #selectTahun, #selectsumberdata').on('change', function () {\r\n");
      out.write("            table.ajax.reload();\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // Ekspor halaman aktif ke Excel\r\n");
      out.write("        $('#downloadExcelBtnPage').on('click', function () {\r\n");
      out.write("            table.button('.buttons-excel').trigger();\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // show Data Detail/Daftar PerProv/PerUpi Modal Large \r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        $('#dataModal').on('shown.bs.modal', function () {\r\n");
      out.write("            if ($.fn.DataTable.isDataTable('#table_mondaf_provupi')) {\r\n");
      out.write("                $('#table_mondaf_provupi').DataTable().clear().destroy();\r\n");
      out.write("                // $('#table_mondaf_provupi').empty();\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            console.log('parameter :'+detailFilterParams);\r\n");
      out.write("\r\n");
      out.write("            $('#table_mondaf_provupi').DataTable({\r\n");
      out.write("                processing: true,\r\n");
      out.write("                serverSide: true,\r\n");
      out.write("                scrollX: true,\r\n");
      out.write("                paging: true,\r\n");
      out.write("                ajax: {\r\n");
      out.write("                    url: '");
      out.print( request.getContextPath() );
      out.write("/bpbl',\r\n");
      out.write("                    type: 'POST',\r\n");
      out.write("                    data: function (d) {\r\n");
      out.write("                        return Object.assign(d, detailFilterParams); // gabungkan dengan parameter datatable\r\n");
      out.write("                    },\r\n");
      out.write("                    dataSrc: function (json) {\r\n");
      out.write("                        console.log('Response JSON:', json);\r\n");
      out.write("                        return json.data;\r\n");
      out.write("                    }\r\n");
      out.write("                },\r\n");
      out.write("                columns: [\r\n");
      out.write("                            {\r\n");
      out.write("                                data: null,\r\n");
      out.write("                                render: function (data, type, row, meta) {\r\n");
      out.write("                                    return meta.row + 1 + meta.settings._iDisplayStart;\r\n");
      out.write("                                }\r\n");
      out.write("                            },\r\n");
      out.write("                            ...[\r\n");
      out.write("                                // \"TOTAL_COUNT\", \r\n");
      out.write("                                \"DATA\", \r\n");
      out.write("                                \"ID_KOLEKTIF\", \r\n");
      out.write("                                \"IDURUT_BPBL\", \r\n");
      out.write("                                \"TANGGAL_USULAN\", \r\n");
      out.write("                                \"KODE_PENGUSUL\", \r\n");
      out.write("                                \"NAMA_PELANGGAN\", \r\n");
      out.write("                                \"NIK\", \r\n");
      out.write("                                \"ALAMAT\", \r\n");
      out.write("                                \"KD_PROV\", \r\n");
      out.write("                                \"KD_PROV_USULAN\", \r\n");
      out.write("                                \"PROVINSI\", \r\n");
      out.write("                                \"PROVINSI_USULAN\", \r\n");
      out.write("                                \"KD_KAB\", \r\n");
      out.write("                                \"KD_KAB_USULAN\", \r\n");
      out.write("                                \"KABUPATENKOTA\", \r\n");
      out.write("                                \"KABUPATENKOTA_USULAN\", \r\n");
      out.write("                                \"KD_KEC\", \r\n");
      out.write("                                \"KD_KEC_USULAN\", \r\n");
      out.write("                                \"KECAMATAN\", \r\n");
      out.write("                                \"KECAMATAN_USULAN\", \r\n");
      out.write("                                \"KD_KEL\", \r\n");
      out.write("                                \"KD_KEL_USULAN\", \r\n");
      out.write("                                \"DESAKELURAHAN\", \r\n");
      out.write("                                \"DESAKELURAHAN_USULAN\", \r\n");
      out.write("                                \"UNITUPI\", \r\n");
      out.write("                                \"NAMA_UNITUPI\", \r\n");
      out.write("                                \"UNITAP\", \r\n");
      out.write("                                \"NAMA_UNITAP\", \r\n");
      out.write("                                \"UNITUP\", \r\n");
      out.write("                                \"NAMA_UNITUP\", \r\n");
      out.write("                                \"STATUS_UPLOAD\", \r\n");
      out.write("                                \"STATUS_DATA\", \r\n");
      out.write("                                \"USER_ID\", \r\n");
      out.write("                                \"TGL_UPLOAD\", \r\n");
      out.write("                                \"NAMA_FILE_UPLOAD\", \r\n");
      out.write("                                \"PATH_FILE\", \r\n");
      out.write("                                \"DOKUMEN_UPLOAD\", \r\n");
      out.write("                                \"PATH_DOKUMEN\", \r\n");
      out.write("                                \"SURAT_VALDES\", \r\n");
      out.write("                                \"PRIORITAS\", \r\n");
      out.write("                                \"VERIFIKASI_DJK\", \r\n");
      out.write("                                \"SUMBER_DATA\", \r\n");
      out.write("                                \"KETERANGAN\", \r\n");
      out.write("                                \"TAHUN\", \r\n");
      out.write("                                \"TGL_KOREKSI\", \r\n");
      out.write("                                \"USERID_KOREKSI\", \r\n");
      out.write("                                \"NAMA_FILE_KOREKSI\", \r\n");
      out.write("                                \"PATH_FILE_KOREKSI\", \r\n");
      out.write("                                \"USERID_VERIFIKASI\", \r\n");
      out.write("                                \"STATUS_VERIFIKASI\", \r\n");
      out.write("                                \"TGL_VERIFIKASI\", \r\n");
      out.write("                                \"STATUS_CUTOFF\", \r\n");
      out.write("                                // \"ROW_NUMBER\", \r\n");
      out.write("                            ].map(field => ({\r\n");
      out.write("                                data: field,\r\n");
      out.write("                                defaultContent: '-',\r\n");
      out.write("                                render: function (data, type, row) {\r\n");
      out.write("                                    return typeof data === 'string' ? data.toUpperCase() : data;\r\n");
      out.write("                                }\r\n");
      out.write("                            }))\r\n");
      out.write("                        ],\r\n");
      out.write("                lengthMenu: [[10, 100], [10, 100]],\r\n");
      out.write("                pageLength: 10,\r\n");
      out.write("                dom: 'lfrtip'\r\n");
      out.write("            });\r\n");
      out.write("        });\r\n");
      out.write("        \r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        // export exel all record all page\r\n");
      out.write("        // ---------------------------------------------------------------------------------------------\r\n");
      out.write("        $('#downloadExcelBtnAll').on('click', async function () {\r\n");
      out.write("            const btn = $(this);\r\n");
      out.write("\r\n");
      out.write("            const vtahun    = detailFilterParams.vtahun;\r\n");
      out.write("            const vdata     = detailFilterParams.vdata;\r\n");
      out.write("            const voption   = detailFilterParams.voption;\r\n");
      out.write("            const vidoption = detailFilterParams.vidoption;\r\n");
      out.write("\r\n");
      out.write("            if (!vtahun || !vdata || !voption ) {\r\n");
      out.write("                alert('Silakan pilih Tahun, Jenis, dan Kriteria Data terlebih dahulu!');\r\n");
      out.write("                return;\r\n");
      out.write("            }\r\n");
      out.write("\r\n");
      out.write("            const info = table.page.info();\r\n");
      out.write("            const start = info.start;\r\n");
      out.write("            const length = info.length;\r\n");
      out.write("\r\n");
      out.write("            btn.prop('disabled', true).text('Memuat...');\r\n");
      out.write("\r\n");
      out.write("            try {\r\n");
      out.write("                const baseUrl = window.location.origin;\r\n");
      out.write("                const url = baseUrl + \"");
      out.print( request.getContextPath() );
      out.write("/bpbl\";\r\n");
      out.write("\r\n");
      out.write("                const params = new URLSearchParams();\r\n");
      out.write("                params.append('start', start);\r\n");
      out.write("                params.append('length', length);\r\n");
      out.write("                params.append('all', 'true');\r\n");
      out.write("                params.append('vtahun', vtahun);\r\n");
      out.write("                params.append('vdata', vdata);\r\n");
      out.write("                params.append('voption', voption);\r\n");
      out.write("                params.append('vidoption', vidoption);\r\n");
      out.write("\r\n");
      out.write("                const response = await fetch(url, {\r\n");
      out.write("                    method: 'POST',\r\n");
      out.write("                    headers: {\r\n");
      out.write("                        'Content-Type': 'application/x-www-form-urlencoded',\r\n");
      out.write("                    },\r\n");
      out.write("                    body: params.toString()\r\n");
      out.write("                });\r\n");
      out.write("\r\n");
      out.write("                if (!response.ok) {\r\n");
      out.write("                    throw new Error('Gagal mengambil data dari server');\r\n");
      out.write("                }\r\n");
      out.write("\r\n");
      out.write("                const json = await response.json();\r\n");
      out.write("                const allData = json.data || [];\r\n");
      out.write("\r\n");
      out.write("                const headers = {\r\n");
      out.write("                    'NO': '',\r\n");
      out.write("                    // 'TOTAL_COUNT': '',\r\n");
      out.write("                    'DATA': '',\r\n");
      out.write("                    'ID_KOLEKTIF': '',\r\n");
      out.write("                    'IDURUT_BPBL': '',\r\n");
      out.write("                    'TANGGAL_USULAN': '',\r\n");
      out.write("                    'KODE_PENGUSUL': '',\r\n");
      out.write("                    'NAMA_PELANGGAN': '',\r\n");
      out.write("                    'NIK': '',\r\n");
      out.write("                    'ALAMAT': '',\r\n");
      out.write("                    'KD_PROV': '',\r\n");
      out.write("                    'KD_PROV_USULAN': '',\r\n");
      out.write("                    'PROVINSI': '',\r\n");
      out.write("                    'PROVINSI_USULAN': '',\r\n");
      out.write("                    'KD_KAB': '',\r\n");
      out.write("                    'KD_KAB_USULAN': '',\r\n");
      out.write("                    'KABUPATENKOTA': '',\r\n");
      out.write("                    'KABUPATENKOTA_USULAN': '',\r\n");
      out.write("                    'KD_KEC': '',\r\n");
      out.write("                    'KD_KEC_USULAN': '',\r\n");
      out.write("                    'KECAMATAN': '',\r\n");
      out.write("                    'KECAMATAN_USULAN': '',\r\n");
      out.write("                    'KD_KEL': '',\r\n");
      out.write("                    'KD_KEL_USULAN': '',\r\n");
      out.write("                    'DESAKELURAHAN': '',\r\n");
      out.write("                    'DESAKELURAHAN_USULAN': '',\r\n");
      out.write("                    'UNITUPI': '',\r\n");
      out.write("                    'NAMA_UNITUPI': '',\r\n");
      out.write("                    'UNITAP': '',\r\n");
      out.write("                    'NAMA_UNITAP': '',\r\n");
      out.write("                    'UNITUP': '',\r\n");
      out.write("                    'NAMA_UNITUP': '',\r\n");
      out.write("                    'STATUS_UPLOAD': '',\r\n");
      out.write("                    'STATUS_DATA': '',\r\n");
      out.write("                    'USER_ID': '',\r\n");
      out.write("                    'TGL_UPLOAD': '',\r\n");
      out.write("                    'NAMA_FILE_UPLOAD': '',\r\n");
      out.write("                    'PATH_FILE': '',\r\n");
      out.write("                    'DOKUMEN_UPLOAD': '',\r\n");
      out.write("                    'PATH_DOKUMEN': '',\r\n");
      out.write("                    'SURAT_VALDES': '',\r\n");
      out.write("                    'PRIORITAS': '',\r\n");
      out.write("                    'VERIFIKASI_DJK': '',\r\n");
      out.write("                    'SUMBER_DATA': '',\r\n");
      out.write("                    'KETERANGAN': '',\r\n");
      out.write("                    'TAHUN': '',\r\n");
      out.write("                    'TGL_KOREKSI': '',\r\n");
      out.write("                    'USERID_KOREKSI': '',\r\n");
      out.write("                    'NAMA_FILE_KOREKSI': '',\r\n");
      out.write("                    'PATH_FILE_KOREKSI': '',\r\n");
      out.write("                    'USERID_VERIFIKASI': '',\r\n");
      out.write("                    'STATUS_VERIFIKASI': '',\r\n");
      out.write("                    'TGL_VERIFIKASI': '',\r\n");
      out.write("                    'STATUS_CUTOFF': '',\r\n");
      out.write("                    // 'ROW_NUMBER': ''\r\n");
      out.write("                };\r\n");
      out.write("\r\n");
      out.write("                const formattedData = allData.length > 0\r\n");
      out.write("                    ? allData.map((item) => {\r\n");
      out.write("                        const row = {};\r\n");
      out.write("                        Object.keys(headers).forEach((key) => {\r\n");
      out.write("                            const value = item[key];\r\n");
      out.write("                            row[key] = (typeof value === 'string') ? value.toUpperCase() : value;\r\n");
      out.write("                        });\r\n");
      out.write("                        row['NO'] = item.ROW_NUMBER; // Tetap gunakan nomor urut asli\r\n");
      out.write("                        return row;\r\n");
      out.write("                    })\r\n");
      out.write("                    : [];\r\n");
      out.write("\r\n");
      out.write("                const ws = XLSX.utils.json_to_sheet(formattedData, { header: Object.keys(headers) });\r\n");
      out.write("                const wb = XLSX.utils.book_new();\r\n");
      out.write("                XLSX.utils.book_append_sheet(wb, ws, \"BPBL Semua Data\");\r\n");
      out.write("\r\n");
      out.write("                const filename = \"BPBL_\" + voption + \"_\" + vdata + \"_\" + vtahun + \".xlsx\";\r\n");
      out.write("                XLSX.writeFile(wb, filename);\r\n");
      out.write("\r\n");
      out.write("            } catch (error) {\r\n");
      out.write("                alert('Terjadi kesalahan saat mengambil data: ' + error.message);\r\n");
      out.write("                console.error('Detail error:', error);\r\n");
      out.write("            } finally {\r\n");
      out.write("                btn.prop('disabled', false).text('Download Excel Semua Halaman');\r\n");
      out.write("            }\r\n");
      out.write("        });\r\n");
      out.write("\r\n");
      out.write("    });\r\n");
      out.write("</script>\r\n");
    } catch (java.lang.Throwable t) {
      if (!(t instanceof javax.servlet.jsp.SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          try { out.clearBuffer(); } catch (java.io.IOException e) {}
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
